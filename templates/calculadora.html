{% extends "base.html" %}

{% block title %}Calculadora de Inversion - RVC Analyzer{% endblock %}

{% block extra_css %}
<style>
    .calc-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        border-bottom: 2px solid #e9ecef;
    }

    .calc-tab {
        padding: 1rem 1.5rem;
        background: none;
        border: none;
        color: #6c757d;
        font-weight: 600;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
    }

    .calc-tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
    }

    .calc-tab:hover {
        color: #667eea;
    }

    .calc-content {
        display: none;
    }

    .calc-content.active {
        display: block;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-group label {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #495057;
    }

    .form-group input,
    .form-group select {
        padding: 0.75rem;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #667eea;
    }

    .field-hint {
        margin-top: 0.35rem;
        font-size: 0.8rem;
        color: #6c757d;
    }

    .scenario-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .scenario-card {
        padding: 1rem;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
    }

    .scenario-card:hover {
        border-color: #667eea;
        transform: translateY(-2px);
    }

    .scenario-card.selected {
        border-color: #667eea;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    }

    .scenario-card .scenario-title {
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: #212529;
    }

    .scenario-card .scenario-return {
        font-size: 1.5rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 0.25rem;
    }

    .scenario-card .scenario-desc {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .result-card {
        padding: 1.5rem;
        border-radius: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.2);
    }

    .result-card .label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
    }

    .result-card .value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .result-card .subvalue {
        font-size: 0.95rem;
        opacity: 0.9;
    }

    .result-card.success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }

    .result-card.info {
        background: linear-gradient(135deg, #17a2b8 0%, #0056b3 100%);
    }

    .result-card.warning {
        background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
    }

    .chart-container {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }

    .insights-section {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 12px;
        border-left: 4px solid #667eea;
    }

    .insights-section h3 {
        margin-top: 0;
        color: #667eea;
    }

    .insight-item {
        padding: 0.75rem;
        background: white;
        border-radius: 8px;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .insight-item:last-child {
        margin-bottom: 0;
    }

    .comparison-table {
        width: 100%;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .comparison-table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem;
        text-align: left;
    }

    .comparison-table td {
        padding: 1rem;
        border-bottom: 1px solid #e9ecef;
    }

    .comparison-table tr:last-child td {
        border-bottom: none;
    }

    .winner-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: #28a745;
        color: white;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-left: 0.5rem;
    }

    .milestone-timeline {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .milestone-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .milestone-year {
        font-size: 1.5rem;
        font-weight: 700;
        color: #667eea;
        min-width: 90px;
    }

    .milestone-bar {
        flex: 1;
        height: 36px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 18px;
    }

    .milestone-value {
        font-weight: 700;
        color: #212529;
        min-width: 150px;
        text-align: right;
    }

    .yearly-table {
        width: 100%;
        background: white;
        border-radius: 12px;
        overflow-x: auto;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-top: 2rem;
    }

    .yearly-table table {
        width: 100%;
        border-collapse: collapse;
    }

    .yearly-table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem;
        text-align: right;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .yearly-table th:first-child {
        text-align: left;
    }

    .yearly-table td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e9ecef;
        text-align: right;
        font-size: 0.9rem;
    }

    .yearly-table td:first-child {
        text-align: left;
        font-weight: 600;
        color: #667eea;
    }

    .yearly-table tr:hover {
        background: #f8f9fa;
    }

    .hidden {
        display: none !important;
    }

    .loading {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: #667eea;
        font-weight: 600;
    }

    .spinner {
        width: 24px;
        height: 24px;
        border: 3px solid rgba(102, 126, 234, 0.3);
        border-top-color: #667eea;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    @media (max-width: 768px) {
        .calc-tabs {
            flex-direction: column;
        }

        .results-grid {
            grid-template-columns: 1fr;
        }

        .form-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <section class="page-hero">
        <h1 class="page-hero__title">Calculadora de Inversion</h1>
        <p class="page-hero__subtitle">Proyecta tus aportes mensuales ajustados por inflacion, compara estrategias y entiende el impacto del interes compuesto bajo escenarios de mercado realistas. Cada modulo se detiene al alcanzar 1,000,000 USD para mantener proyecciones prudentes.</p>
    </section>

    <div class="calc-tabs">
        <button class="calc-tab active" data-tab="retirement">Plan de jubilacion</button>
        <button class="calc-tab" data-tab="dca">Dollar Cost Averaging</button>
        <button class="calc-tab" data-tab="lump-sum">Lump Sum vs DCA</button>
        <button class="calc-tab" data-tab="compound">Interes compuesto</button>
    </div>

    <div class="calc-content active" id="retirement-content">
        <h2>Plan de jubilacion con inflacion</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Calculamos mes a mes tus aportes crecientes, sumamos el interes compuesto esperado y generamos escenarios conservador, realista y optimista.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="ret-current-age">Edad actual</label>
                <input type="number" id="ret-current-age" value="35" min="18" max="75" step="1">
            </div>
            <div class="form-group">
                <label for="ret-retirement-age">Edad de retiro deseada</label>
                <input type="number" id="ret-retirement-age" value="65" min="18" max="75" step="1">
            </div>
            <div class="form-group">
                <label for="ret-initial">Capital inicial ($)</label>
                <input type="number" id="ret-initial" value="10000" min="0" step="500">
                <small class="field-hint">Ahorros o inversiones ya acumuladas.</small>
            </div>
            <div class="form-group">
                <label for="ret-monthly">Ahorro mensual inicial ($)</label>
                <input type="number" id="ret-monthly" value="500" min="0" step="50">
                <small class="field-hint">Se actualiza cada anio segun la inflacion estimada.</small>
            </div>
            <div class="form-group">
                <label for="ret-return">Rendimiento anual esperado (%)</label>
                <input type="number" id="ret-return" value="10" min="-10" max="20" step="0.5">
                <small class="field-hint">Usa 10% como referencia del S&P 500 historico.</small>
            </div>
            <div class="form-group">
                <label for="ret-inflation">Inflacion anual esperada (%)</label>
                <input type="number" id="ret-inflation" value="3" min="0" max="15" step="0.5">
                <small class="field-hint">Aumentamos tus aportes cada 12 meses con este ritmo.</small>
            </div>
        </div>

        <div class="insights-section" style="margin-bottom: 2rem;">
            <h3>Glosario rapido</h3>
            <div class="insight-item">
                <strong>Dollar Cost Averaging (DCA)</strong>
                <p style="margin: 0;">Invertir una cantidad fija con frecuencia definida para reducir el riesgo de entrar al mercado en el peor momento.</p>
            </div>
            <div class="insight-item">
                <strong>Lump Sum</strong>
                <p style="margin: 0;">Invertir todo el capital disponible de inmediato. Maximiza el tiempo invertido pero requiere tolerancia a la volatilidad.</p>
            </div>
            <div class="insight-item">
                <strong>Inflacion</strong>
                <p style="margin: 0;">Incremento de precios que erosiona el poder adquisitivo. Ajustamos tus aportes anualmente para conservar su valor real.</p>
            </div>
        </div>

        <button id="calculate-retirement" type="button" class="btn btn--primary btn--block">
            Calcular plan de jubilacion
        </button>

        <div id="ret-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Calculando proyeccion...
        </div>

        <div id="ret-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>

    <div class="calc-content" id="dca-content">
        <h2>Simulador Dollar Cost Averaging (DCA)</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Estimamos la inversion mensual creciente, simulamos escenarios de mercado y destacamos cuando alcanzas el limite de 1,000,000 USD.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="dca-initial">Capital inicial ($)</label>
                <input type="number" id="dca-initial" value="0" min="0" step="100">
                <small class="field-hint">Se invierte en el primer mes al precio simulado.</small>
            </div>
            <div class="form-group">
                <label for="dca-monthly">Aporte mensual inicial ($)</label>
                <input type="number" id="dca-monthly" value="500" min="0" step="10">
                <small class="field-hint">Se incrementa cada anio con la inflacion indicada.</small>
            </div>
            <div class="form-group">
                <label for="dca-years">Anios de inversion</label>
                <input type="number" id="dca-years" value="15" min="1" max="50" step="1">
                <small class="field-hint">Largo plazo recomendado: 10, 20 o 30 anios.</small>
            </div>
            <div class="form-group">
                <label for="dca-inflation">Inflacion anual esperada (%)</label>
                <input type="number" id="dca-inflation" value="3" min="0" max="15" step="0.5">
                <small class="field-hint">Ajustamos tus aportes cada 12 meses con este porcentaje.</small>
            </div>
            <div class="form-group">
                <label for="dca-timing">Momento del mercado</label>
                <select id="dca-timing">
                    <option value="normal" selected>Normal (promedio historico)</option>
                    <option value="crisis">Crisis (caida inicial 40%)</option>
                    <option value="burbuja">Burbuja (mercado sobrevaluado +40%)</option>
                </select>
                <small class="field-hint">Explora el impacto de iniciar con precios altos o bajos.</small>
            </div>
        </div>

        <h3>Escenarios de rendimiento</h3>
        <p style="color: #6c757d; margin-top: -0.5rem;">Basados en retornos nominales promedio de referencia.</p>
        <div class="scenario-cards">
            <div class="scenario-card" data-scenario="conservador">
                <div class="scenario-title">Conservador</div>
                <div class="scenario-return">7% anual</div>
                <div class="scenario-desc">Bonos globales y fondos defensivos.</div>
            </div>
            <div class="scenario-card selected" data-scenario="moderado">
                <div class="scenario-title">Base S&P 500</div>
                <div class="scenario-return">10% anual</div>
                <div class="scenario-desc">Retorno historico de S&P 500 / ETF VOO.</div>
            </div>
            <div class="scenario-card" data-scenario="optimista">
                <div class="scenario-title">Optimista</div>
                <div class="scenario-return">12% anual</div>
                <div class="scenario-desc">Cartera concentrada en crecimiento.</div>
            </div>
        </div>

        <button id="calculate-dca" type="button" class="btn btn--primary btn--block">
            Calcular proyeccion DCA
        </button>

        <div id="dca-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Calculando proyeccion...
        </div>

        <div id="dca-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>

    <div class="calc-content" id="lump-sum-content">
        <h2>Comparacion: Lump Sum vs DCA</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Compara invertir todo de una vez contra repartir el mismo capital en aportes mensuales. Este modulo usa aportes constantes (sin ajuste por inflacion) para mantener la comparacion justa.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="ls-total">Monto total disponible ($)</label>
                <input type="number" id="ls-total" value="10000" min="100" step="100">
            </div>
            <div class="form-group">
                <label for="ls-years">Periodo de comparacion (anios)</label>
                <input type="number" id="ls-years" value="10" min="1" max="50" step="1">
            </div>
            <div class="form-group">
                <label for="ls-scenario">Escenario de rendimiento</label>
                <select id="ls-scenario">
                    <option value="conservador">Conservador (7%)</option>
                    <option value="moderado" selected>Moderado (10%)</option>
                    <option value="optimista">Optimista (12%)</option>
                </select>
            </div>
        </div>

        <button id="calculate-lump-sum" type="button" class="btn btn--primary btn--block">
            Comparar estrategias
        </button>

        <div id="ls-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Comparando estrategias...
        </div>

        <div id="ls-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>

    <div class="calc-content" id="compound-content">
        <h2>Impacto del interes compuesto</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Visualiza cuanto proviene de tus aportes versus los intereses generados en distintos horizontes. La proyeccion se detiene si alcanzas 1,000,000 USD.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="ci-initial">Inversion inicial ($)</label>
                <input type="number" id="ci-initial" value="5000" min="0" step="100">
            </div>
            <div class="form-group">
                <label for="ci-monthly">Aporte mensual ($)</label>
                <input type="number" id="ci-monthly" value="300" min="0" step="10">
            </div>
            <div class="form-group">
                <label for="ci-years">Anios de inversion</label>
                <input type="number" id="ci-years" value="20" min="1" max="50" step="1">
            </div>
            <div class="form-group">
                <label for="ci-scenario">Retorno esperado</label>
                <select id="ci-scenario">
                    <option value="conservador">Conservador (7%)</option>
                    <option value="moderado" selected>Moderado (10%)</option>
                    <option value="optimista">Optimista (12%)</option>
                </select>
            </div>
        </div>

        <button id="calculate-compound" type="button" class="btn btn--primary btn--block">
            Calcular impacto
        </button>

        <div id="ci-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Calculando impacto...
        </div>

        <div id="ci-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='calculadora.js') }}"></script>
{% endblock %}
