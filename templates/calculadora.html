{% extends "base.html" %}
{% from "_icons.html" import icon %}

{% block title %}Calculadora de Inversi√≥n - RVC Analyzer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='calculadora.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <section class="page-hero">
        <h1 class="page-hero__title">Calculadora de Inversi√≥n</h1>
        <p class="page-hero__subtitle">Proyecta aportes mensuales ajustados por inflaci√≥n, compara estrategias y entiende el inter√©s compuesto bajo escenarios de mercado realistas.</p>
        <p class="page-hero__disclaimer">Esta calculadora estima el crecimiento de tus aportes (ajustados por inflaci√≥n) bajo distintos escenarios. Para mantener proyecciones prudentes y comparables, por defecto, la simulaci√≥n se detiene al alcanzar un <strong>$1.000.000</strong>. Los resultados son estimaciones sujetas a supuestos de rendimiento, inflaci√≥n y volatilidad.</p>
    </section>

    <section class="calc-section">
        <div class="calc-tabs">
        <button class="calc-tab active" data-tab="retirement">Plan de jubilaci√≥n</button>
        <button class="calc-tab" data-tab="dca">Dollar Cost Averaging</button>
        <button class="calc-tab" data-tab="lump-sum">Lump Sum vs DCA</button>
    <button class="calc-tab" data-tab="compound">Inter√©s compuesto</button>
    </div>

    <div class="calc-content active" id="retirement-content">
    <h2>Plan de jubilaci√≥n con inflaci√≥n</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Calculamos mes a mes tus aportes crecientes, sumamos el inter√©s compuesto esperado y generamos escenarios conservador, realista y optimista.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="ret-current-age">Edad actual</label>
                <div class="input-with-symbol">
                    <input type="number" id="ret-current-age" value="35" min="18" max="75" step="1" data-suffix="a√±os">
                    <span class="input-suffix">a√±os</span>
                </div>
            </div>
            <div class="form-group">
                <label for="ret-retirement-age">Edad de retiro deseada</label>
                <div class="input-with-symbol">
                    <input type="number" id="ret-retirement-age" value="65" min="18" max="75" step="1" data-suffix="a√±os">
                    <span class="input-suffix">a√±os</span>
                </div>
            </div>
            <div class="form-group">
                <label for="ret-initial">Capital inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ret-initial" value="10.000" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
                <small class="field-hint">Ahorros o inversiones ya acumuladas.</small>
            </div>
            <div class="form-group">
                <label for="ret-monthly">Ahorro mensual inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ret-monthly" value="500" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
                <small class="field-hint">Se actualiza cada a√±o seg√∫n la inflaci√≥n estimada.</small>
            </div>
            <div class="form-group">
                <div class="label-with-tooltip">
                    <label for="ret-return">Rendimiento anual esperado (%)</label>
                    <span class="info-tooltip">
                        <span>‚Ñπ</span>
                        <div class="tooltip-content">
                            <div class="tooltip-title">üí° Gu√≠a de Rendimiento</div>
                            <div class="tooltip-option">
                                <strong>Conservador (7%)</strong>
                                <small>Cartera diversificada 60/40 o sesgo defensivo. Media hist√≥rica ~6‚Äì7%.</small>
                            </div>
                            <div class="tooltip-option">
                                <strong>Base S&P 500 (10%)</strong>
                                <small>Promedio hist√≥rico del S&P 500 con dividendos reinvertidos.</small>
                            </div>
                            <div class="tooltip-option">
                                <strong>Optimista (12%)</strong>
                                <small>Growth/tecnolog√≠a en ciclo favorable. No es promedio hist√≥rico sostenible.</small>
                            </div>
                        </div>
                    </span>
                </div>
                <div class="input-with-symbol">
                    <input type="number" id="ret-return" value="10" min="-10" max="20" step="0.5" data-suffix="%">
                    <span class="input-suffix">%</span>
                </div>
                <small class="field-hint">Usa 10% como referencia del S&P 500 hist√≥rico.</small>
            </div>
            <div class="form-group">
                <div class="label-with-tooltip">
                    <label for="ret-inflation">Inflaci√≥n anual esperada (%)</label>
                    <span class="info-tooltip">
                        <span>‚Ñπ</span>
                        <div class="tooltip-content">
                            <div class="tooltip-title">üìä Referencia Colombia</div>
                            <div class="tooltip-reference">
                                En Colombia, la <strong>inflaci√≥n promedio</strong> de los √∫ltimos 10 a√±os (2015‚Äì2024) fue de <strong>~5,8% anual</strong> (variaci√≥n anual del IPC).
                            </div>
                            <div class="tooltip-reference" style="margin-top: 0.5rem;">
                                üí° <strong>Tip:</strong> Usa 3-4% para econom√≠as estables (USD), 5-6% para Colombia.
                            </div>
                        </div>
                    </span>
                </div>
                <div class="input-with-symbol">
                    <input type="number" id="ret-inflation" value="3" min="0" max="15" step="0.5" data-suffix="%">
                    <span class="input-suffix">%</span>
                </div>
                <small class="field-hint">Aumentamos tus aportes cada 12 meses con este ritmo.</small>
            </div>
        </div>

        <!-- Checkbox de indexaci√≥n anual -->
        <div class="form-group" style="margin-top: 1rem; margin-bottom: 1.5rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="ret-indexing" checked style="width: auto; cursor: pointer;">
                <span>Ajustar aportes por inflaci√≥n cada 12 meses</span>
            </label>
            <small class="field-hint" style="margin-left: 1.5rem;">
                Si est√° activo, subiremos tu aporte una vez al a√±o seg√∫n la inflaci√≥n indicada para mantener el mismo esfuerzo real. Si est√° desactivado, aportar√°s siempre la misma cantidad en d√≥lares, pero perder√° poder adquisitivo con el tiempo.
            </small>
        </div>


        <button id="calculate-retirement" type="button" class="btn btn--primary btn--block">
            {{ icon('calculator', size=18, class_name='me-1') }} Calcular plan de jubilaci√≥n
        </button>

        <div id="ret-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Calculando proyecci√≥n...
        </div>

        <div id="ret-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>

    <div class="calc-content" id="dca-content">
    <h2>Simulador Dollar Cost Averaging (DCA)</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Estimamos la inversi√≥n mensual creciente, simulamos escenarios de mercado y destacamos cuando alcanzas el l√≠mite de 1.000.000 USD.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="dca-initial">Capital inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="dca-initial" value="0" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
                <small class="field-hint">Se invierte en el primer mes al precio simulado.</small>
            </div>
            <div class="form-group">
                <label for="dca-monthly">Aporte mensual inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="dca-monthly" value="500" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
                <small class="field-hint">Se incrementa cada a√±o con la inflaci√≥n indicada.</small>
            </div>
            <div class="form-group">
                <label for="dca-years">A√±os de inversi√≥n</label>
                <div class="input-with-symbol">
                    <input type="number" id="dca-years" value="15" min="1" max="50" step="1" data-suffix="a√±os">
                    <span class="input-suffix">a√±os</span>
                </div>
                <small class="field-hint">Largo plazo recomendado: 10, 20 o 30 a√±os.</small>
            </div>
            <div class="form-group">
                <div class="label-with-tooltip">
                    <label for="dca-inflation">Inflaci√≥n anual esperada (%)</label>
                    <span class="info-tooltip">
                        <span>‚Ñπ</span>
                        <div class="tooltip-content">
                            <div class="tooltip-title">üìä Referencia Colombia</div>
                            <div class="tooltip-reference">
                                En Colombia, la <strong>inflaci√≥n promedio</strong> de los √∫ltimos 10 a√±os (2015‚Äì2024) fue de <strong>~5,8% anual</strong> (variaci√≥n anual del IPC).
                            </div>
                            <div class="tooltip-reference" style="margin-top: 0.5rem;">
                                üí° <strong>Tip:</strong> Usa 3-4% para econom√≠as estables (USD), 5-6% para Colombia.
                            </div>
                        </div>
                    </span>
                </div>
                <div class="input-with-symbol">
                    <input type="number" id="dca-inflation" value="3" min="0" max="15" step="0.5" data-suffix="%">
                    <span class="input-suffix">%</span>
                </div>
                <small class="field-hint">Ajustamos tus aportes cada 12 meses con este porcentaje.</small>
            </div>
            <div class="form-group">
                <label for="dca-timing">Momento del mercado</label>
                <select id="dca-timing">
                    <option value="normal" selected>Normal (promedio hist√≥rico)</option>
                    <option value="crisis">Crisis (ca√≠da inicial 40%)</option>
                    <option value="burbuja">Burbuja (mercado sobrevaluado +40%)</option>
                </select>
                <small class="field-hint">Explora el impacto de iniciar con precios altos o bajos.</small>
            </div>
        </div>

        <!-- Checkbox de indexaci√≥n anual -->
        <div class="form-group" style="margin-top: 1rem; margin-bottom: 1.5rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="dca-indexing" checked style="width: auto; cursor: pointer;">
                <span>Ajustar aportes por inflaci√≥n cada 12 meses</span>
            </label>
            <small class="field-hint" style="margin-left: 1.5rem;">
                Si est√° activo, subiremos tu aporte una vez al a√±o seg√∫n la inflaci√≥n indicada para mantener el mismo esfuerzo real. Si est√° desactivado, aportar√°s siempre la misma cantidad en d√≥lares, pero perder√° poder adquisitivo con el tiempo.
            </small>
        </div>

    <h3>Escenarios de rendimiento</h3>
        <p style="color: #6c757d; margin-top: -0.5rem;">Basados en retornos nominales promedio de referencia.</p>
        <div class="scenario-cards">
            <div class="scenario-card" data-scenario="conservador">
                <div class="scenario-title">Conservador</div>
                <div class="scenario-return">7% anual</div>
                <div class="scenario-desc">Bonos globales y fondos defensivos.</div>
            </div>
            <div class="scenario-card selected" data-scenario="moderado">
                <div class="scenario-title">Base S&P 500</div>
                <div class="scenario-return">10% anual</div>
                <div class="scenario-desc">Retorno hist√≥rico de S&P 500 / ETF VOO.</div>
            </div>
            <div class="scenario-card" data-scenario="optimista">
                <div class="scenario-title">Optimista</div>
                <div class="scenario-return">12% anual</div>
                <div class="scenario-desc">Cartera concentrada en crecimiento.</div>
            </div>
        </div>

        <button id="calculate-dca" type="button" class="btn btn--primary btn--block">
            {{ icon('calculator', size=18, class_name='me-1') }} Calcular proyecci√≥n DCA
        </button>

        <div id="dca-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Calculando proyecci√≥n...
        </div>

        <div id="dca-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>

    <div class="calc-content" id="lump-sum-content">
    <h2>Comparaci√≥n: Lump Sum vs DCA</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Compara invertir todo de una vez contra repartir el mismo capital en aportes mensuales. Este m√≥dulo usa aportes constantes (sin ajuste por inflaci√≥n) para mantener la comparaci√≥n justa.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="ls-total">Monto total disponible</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ls-total" value="10.000" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
            </div>
            <div class="form-group">
                <label for="ls-years">Per√≠odo de comparaci√≥n (a√±os)</label>
                <div class="input-with-symbol">
                    <input type="number" id="ls-years" value="10" min="1" max="50" step="1" data-suffix="a√±os">
                    <span class="input-suffix">a√±os</span>
                </div>
            </div>
            <div class="form-group">
                <div class="label-with-tooltip">
                    <label for="ls-scenario">Escenario de rendimiento</label>
                    <span class="info-tooltip">
                        <span>‚Ñπ</span>
                        <div class="tooltip-content">
                            <div class="tooltip-title">üí° Gu√≠a de Rendimiento</div>
                            <div class="tooltip-option">
                                <strong>Conservador (7%)</strong>
                                <small>Cartera diversificada 60/40 o sesgo defensivo. Media hist√≥rica ~6‚Äì7%.</small>
                            </div>
                            <div class="tooltip-option">
                                <strong>Base S&P 500 (10%)</strong>
                                <small>Promedio hist√≥rico del S&P 500 con dividendos reinvertidos.</small>
                            </div>
                            <div class="tooltip-option">
                                <strong>Optimista (12%)</strong>
                                <small>Growth/tecnolog√≠a en ciclo favorable. No es promedio hist√≥rico sostenible.</small>
                            </div>
                        </div>
                    </span>
                </div>
                <select id="ls-scenario">
                    <option value="conservador">Conservador (7%)</option>
                    <option value="moderado" selected>Moderado (10%)</option>
                    <option value="optimista">Optimista (12%)</option>
                </select>
            </div>
        </div>

        <button id="calculate-lump-sum" type="button" class="btn btn--primary btn--block">
            {{ icon('scale', size=18, class_name='me-1') }} Comparar estrategias
        </button>

        <div id="ls-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Comparando estrategias...
        </div>

        <div id="ls-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>

    <div class="calc-content" id="compound-content">
    <h2>Impacto del inter√©s compuesto</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Visualiza cu√°nto proviene de tus aportes versus los intereses generados en distintos horizontes. La proyecci√≥n se detiene si alcanzas $1.000.000.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="ci-initial">Inversi√≥n inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ci-initial" value="5.000" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
            </div>
            <div class="form-group">
                <label for="ci-monthly">Aporte mensual</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ci-monthly" value="300" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
            </div>
            <div class="form-group">
                <label for="ci-years">A√±os de inversi√≥n</label>
                <div class="input-with-symbol">
                    <input type="number" id="ci-years" value="20" min="1" max="50" step="1" data-suffix="a√±os">
                    <span class="input-suffix">a√±os</span>
                </div>
            </div>
            <div class="form-group">
                <div class="label-with-tooltip">
                    <label for="ci-scenario">Retorno esperado</label>
                    <span class="info-tooltip">
                        <span>‚Ñπ</span>
                        <div class="tooltip-content">
                            <div class="tooltip-title">üí° Gu√≠a de Rendimiento</div>
                            <div class="tooltip-option">
                                <strong>Conservador (7%)</strong>
                                <small>Cartera diversificada 60/40 o sesgo defensivo. Media hist√≥rica ~6‚Äì7%.</small>
                            </div>
                            <div class="tooltip-option">
                                <strong>Base S&P 500 (10%)</strong>
                                <small>Promedio hist√≥rico del S&P 500 con dividendos reinvertidos.</small>
                            </div>
                            <div class="tooltip-option">
                                <strong>Optimista (12%)</strong>
                                <small>Growth/tecnolog√≠a en ciclo favorable. No es promedio hist√≥rico sostenible.</small>
                            </div>
                        </div>
                    </span>
                </div>
                <select id="ci-scenario">
                    <option value="conservador">Conservador (7%)</option>
                    <option value="moderado" selected>Moderado (10%)</option>
                    <option value="optimista">Optimista (12%)</option>
                </select>
            </div>
        </div>

        <button id="calculate-compound" type="button" class="btn btn--primary btn--block">
            {{ icon('trending-up', size=18, class_name='me-1') }} Calcular impacto
        </button>

        <div id="ci-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Calculando impacto...
        </div>

        <div id="ci-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='calculadora.js') }}"></script>
{% endblock %}
