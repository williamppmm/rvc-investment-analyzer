{% extends "base.html" %}
{% from "_icons.html" import icon %}

{% block title %}Calculadora de Inversión - RVC Analyzer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='calculadora.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <section class="page-hero">
        <h1 class="page-hero__title">Calculadora de Inversión</h1>
        <p class="page-hero__subtitle">Proyecta aportes mensuales ajustados por inflación, compara estrategias y entiende el interés compuesto bajo escenarios de mercado realistas.</p>
        <p class="page-hero__disclaimer">Esta calculadora estima el crecimiento de tus aportes (ajustados por inflación) bajo distintos escenarios. Para mantener proyecciones prudentes y comparables, por defecto, la simulación se detiene al alcanzar un <strong>$1.000.000</strong>. Los resultados son estimaciones sujetas a supuestos de rendimiento, inflación y volatilidad.</p>
    </section>

    <section class="calc-section">
        <div class="calc-tabs">
        <button class="calc-tab active" data-tab="retirement">Plan de jubilación</button>
        <button class="calc-tab" data-tab="dca">Dollar Cost Averaging</button>
        <button class="calc-tab" data-tab="lump-sum">Lump Sum vs DCA</button>
    <button class="calc-tab" data-tab="compound">Interés compuesto</button>
    </div>

    <div class="calc-content active" id="retirement-content">
    <h2>Plan de jubilación con inflación</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Calculamos mes a mes tus aportes crecientes, sumamos el interés compuesto esperado y generamos escenarios conservador, realista y optimista.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="ret-current-age">Edad actual</label>
                <div class="input-with-symbol">
                    <input type="number" id="ret-current-age" value="35" min="18" max="75" step="1" data-suffix="años">
                    <span class="input-suffix">años</span>
                </div>
            </div>
            <div class="form-group">
                <label for="ret-retirement-age">Edad de retiro deseada</label>
                <div class="input-with-symbol">
                    <input type="number" id="ret-retirement-age" value="65" min="18" max="75" step="1" data-suffix="años">
                    <span class="input-suffix">años</span>
                </div>
            </div>
            <div class="form-group">
                <label for="ret-initial">Capital inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ret-initial" value="10.000" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
                <small class="field-hint">Ahorros o inversiones ya acumuladas.</small>
            </div>
            <div class="form-group">
                <label for="ret-monthly">Ahorro mensual inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ret-monthly" value="500" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
                <small class="field-hint">Se actualiza cada año según la inflación estimada.</small>
            </div>
            <div class="form-group">
                <label for="ret-return">Rendimiento anual esperado (%)</label>
                <div class="input-with-symbol">
                    <input type="number" id="ret-return" value="10" min="-10" max="20" step="0.5" data-suffix="%">
                    <span class="input-suffix">%</span>
                </div>
                <small class="field-hint">Usa 10% como referencia del S&P 500 histórico.</small>
            </div>
            <div class="form-group">
                <label for="ret-inflation">Inflación anual esperada (%)</label>
                <div class="input-with-symbol">
                    <input type="number" id="ret-inflation" value="3" min="0" max="15" step="0.5" data-suffix="%">
                    <span class="input-suffix">%</span>
                </div>
                <small class="field-hint">Aumentamos tus aportes cada 12 meses con este ritmo.</small>
            </div>
        </div>


        <button id="calculate-retirement" type="button" class="btn btn--primary btn--block">
            {{ icon('calculator', size=18, class_name='me-1') }} Calcular plan de jubilación
        </button>

        <div id="ret-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Calculando proyección...
        </div>

        <div id="ret-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>

    <div class="calc-content" id="dca-content">
    <h2>Simulador Dollar Cost Averaging (DCA)</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Estimamos la inversión mensual creciente, simulamos escenarios de mercado y destacamos cuando alcanzas el límite de 1.000.000 USD.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="dca-initial">Capital inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="dca-initial" value="0" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
                <small class="field-hint">Se invierte en el primer mes al precio simulado.</small>
            </div>
            <div class="form-group">
                <label for="dca-monthly">Aporte mensual inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="dca-monthly" value="500" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
                <small class="field-hint">Se incrementa cada año con la inflación indicada.</small>
            </div>
            <div class="form-group">
                <label for="dca-years">Años de inversión</label>
                <div class="input-with-symbol">
                    <input type="number" id="dca-years" value="15" min="1" max="50" step="1" data-suffix="años">
                    <span class="input-suffix">años</span>
                </div>
                <small class="field-hint">Largo plazo recomendado: 10, 20 o 30 años.</small>
            </div>
            <div class="form-group">
                <label for="dca-inflation">Inflación anual esperada (%)</label>
                <div class="input-with-symbol">
                    <input type="number" id="dca-inflation" value="3" min="0" max="15" step="0.5" data-suffix="%">
                    <span class="input-suffix">%</span>
                </div>
                <small class="field-hint">Ajustamos tus aportes cada 12 meses con este porcentaje.</small>
            </div>
            <div class="form-group">
                <label for="dca-timing">Momento del mercado</label>
                <select id="dca-timing">
                    <option value="normal" selected>Normal (promedio histórico)</option>
                    <option value="crisis">Crisis (caída inicial 40%)</option>
                    <option value="burbuja">Burbuja (mercado sobrevaluado +40%)</option>
                </select>
                <small class="field-hint">Explora el impacto de iniciar con precios altos o bajos.</small>
            </div>
        </div>

    <h3>Escenarios de rendimiento</h3>
        <p style="color: #6c757d; margin-top: -0.5rem;">Basados en retornos nominales promedio de referencia.</p>
        <div class="scenario-cards">
            <div class="scenario-card" data-scenario="conservador">
                <div class="scenario-title">Conservador</div>
                <div class="scenario-return">7% anual</div>
                <div class="scenario-desc">Bonos globales y fondos defensivos.</div>
            </div>
            <div class="scenario-card selected" data-scenario="moderado">
                <div class="scenario-title">Base S&P 500</div>
                <div class="scenario-return">10% anual</div>
                <div class="scenario-desc">Retorno histórico de S&P 500 / ETF VOO.</div>
            </div>
            <div class="scenario-card" data-scenario="optimista">
                <div class="scenario-title">Optimista</div>
                <div class="scenario-return">12% anual</div>
                <div class="scenario-desc">Cartera concentrada en crecimiento.</div>
            </div>
        </div>

        <button id="calculate-dca" type="button" class="btn btn--primary btn--block">
            {{ icon('calculator', size=18, class_name='me-1') }} Calcular proyección DCA
        </button>

        <div id="dca-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Calculando proyección...
        </div>

        <div id="dca-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>

    <div class="calc-content" id="lump-sum-content">
    <h2>Comparación: Lump Sum vs DCA</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Compara invertir todo de una vez contra repartir el mismo capital en aportes mensuales. Este módulo usa aportes constantes (sin ajuste por inflación) para mantener la comparación justa.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="ls-total">Monto total disponible</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ls-total" value="10.000" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
            </div>
            <div class="form-group">
                <label for="ls-years">Período de comparación (años)</label>
                <div class="input-with-symbol">
                    <input type="number" id="ls-years" value="10" min="1" max="50" step="1" data-suffix="años">
                    <span class="input-suffix">años</span>
                </div>
            </div>
            <div class="form-group">
                <label for="ls-scenario">Escenario de rendimiento</label>
                <select id="ls-scenario">
                    <option value="conservador">Conservador (7%)</option>
                    <option value="moderado" selected>Moderado (10%)</option>
                    <option value="optimista">Optimista (12%)</option>
                </select>
            </div>
        </div>

        <button id="calculate-lump-sum" type="button" class="btn btn--primary btn--block">
            {{ icon('scale', size=18, class_name='me-1') }} Comparar estrategias
        </button>

        <div id="ls-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Comparando estrategias...
        </div>

        <div id="ls-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>

    <div class="calc-content" id="compound-content">
    <h2>Impacto del interés compuesto</h2>
        <p style="color: #6c757d; margin-bottom: 1.5rem;">
            Visualiza cuánto proviene de tus aportes versus los intereses generados en distintos horizontes. La proyección se detiene si alcanzas $1.000.000.
        </p>

        <div class="form-grid">
            <div class="form-group">
                <label for="ci-initial">Inversión inicial</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ci-initial" value="5.000" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
            </div>
            <div class="form-group">
                <label for="ci-monthly">Aporte mensual</label>
                <div class="input-with-symbol">
                    <span class="input-prefix">$</span>
                    <input type="text" id="ci-monthly" value="300" inputmode="numeric" pattern="[0-9\.]*" data-prefix="$">
                </div>
            </div>
            <div class="form-group">
                <label for="ci-years">Años de inversión</label>
                <div class="input-with-symbol">
                    <input type="number" id="ci-years" value="20" min="1" max="50" step="1" data-suffix="años">
                    <span class="input-suffix">años</span>
                </div>
            </div>
            <div class="form-group">
                <label for="ci-scenario">Retorno esperado</label>
                <select id="ci-scenario">
                    <option value="conservador">Conservador (7%)</option>
                    <option value="moderado" selected>Moderado (10%)</option>
                    <option value="optimista">Optimista (12%)</option>
                </select>
            </div>
        </div>

        <button id="calculate-compound" type="button" class="btn btn--primary btn--block">
            {{ icon('trending-up', size=18, class_name='me-1') }} Calcular impacto
        </button>

        <div id="ci-loading" class="loading hidden" style="margin-top: 2rem;">
            <span class="spinner"></span>
            Calculando impacto...
        </div>

        <div id="ci-results" class="hidden" style="margin-top: 2rem;"></div>
    </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='calculadora.js') }}"></script>
{% endblock %}
