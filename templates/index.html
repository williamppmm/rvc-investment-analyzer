{% extends "base.html" %}
{% from "_icons.html" import icon %}

{% block title %}RVC Analyzer - Radar de Valoracion y Calidad{% endblock %}

{% block content %}
<div class="container">
    <section class="page-hero">
        <h1 class="page-hero__title">Radar de Valoración y Calidad</h1>
        <p class="page-hero__subtitle">RVC Analyzer es un sistema de <span class="term-tooltip">análisis fundamental<span class="term-tooltip__content">Evaluación de empresas basada en métricas financieras, calidad de negocio y perspectivas de largo plazo</span></span> que te ayuda a detectar oportunidades reales de inversión apoyándose en cuatro pilares: calidad del negocio, valoración justa, salud financiera y potencial de crecimiento.</p>
    </section>

    <section class="search-section">
        <h2>Analizar acción individual</h2>
        <p class="search-hint">
            Para evaluar varias acciones a la vez visita el <a href="{{ url_for('comparador') }}" class="link-inline">Comparador</a>.
        </p>
        <div class="search-form">
            <input id="ticker-input" type="text" placeholder="Ticker (ej: MSFT)" maxlength="10">
            <button id="analyze-btn" type="button" class="btn btn--primary">
                {{ icon('search', size=18, class_name='me-1') }} Analizar
            </button>
            <button id="clear-cache-btn" type="button" class="btn btn--secondary">
                {{ icon('trash', size=18, class_name='me-1') }} Limpiar cache
            </button>
        </div>
        <div id="loading" class="loading hidden">
            <span class="spinner"></span>
            Buscando datos financieros...
        </div>

        <button id="toggle-manual-btn" type="button" class="btn btn--secondary hidden">
            Editar métricas manualmente
        </button>
        <div id="manual-input" class="manual-input hidden">
            <h3>Ajustar métricas manualmente</h3>
            <p id="manual-hint" class="manual-hint">
                Si las APIs no devuelven datos recientes puedes capturar los valores de fuentes confiables,
                ingresarlos aquí y volver a ejecutar el análisis.
            </p>
            <div id="manual-fields" class="manual-fields"></div>
            <div class="manual-actions">
                <button id="apply-manual-btn" type="button" class="btn btn--primary">Aplicar ajustes</button>
                <button id="cancel-manual-btn" type="button" class="btn btn--secondary">Cerrar</button>
            </div>
            <div id="manual-feedback" class="manual-feedback hidden"></div>
        </div>
    </section>

    <section id="results" class="results-section hidden">
        <div class="company-info">
            <h2 id="company-name">-</h2>
            <div class="company-details">
                <span id="ticker-badge" class="ticker-badge">-</span>
                <span id="source-badge" class="source-badge">Fuente: -</span>
                <span id="asset-type-badge" class="asset-type-badge hidden">Tipo: -</span>
                <span id="sector-badge" class="sector-badge">-</span>
                <span id="confidence-badge" class="confidence-badge">Confianza: -</span>
            </div>
        </div>

        <div class="rvc-score">
            <h3>Score RVC</h3>
            <div class="score-display">
                <div id="score-circle" class="score-circle">
                    <span id="score-value" class="score-value">-</span>
                    <span class="score-label">/100</span>
                </div>
                <div id="classification" class="classification">-</div>
            </div>
            <div id="recommendation" class="recommendation">-</div>
        </div>

        <div class="breakdown">
            <h3>Desglose del análisis</h3>
            <div class="breakdown-grid">
                <div class="dimension">
                    <h4>Valoración (40%)</h4>
                    <div class="progress-bar"><div id="val-progress" class="progress"></div></div>
                    <span id="val-score" class="dimension-score">-</span>
                    <div id="val-metrics" class="metrics-used">-</div>
                </div>
                <div class="dimension">
                    <h4>Calidad (35%)</h4>
                    <div class="progress-bar"><div id="qual-progress" class="progress"></div></div>
                    <span id="qual-score" class="dimension-score">-</span>
                    <div id="qual-metrics" class="metrics-used">-</div>
                </div>
                <div class="dimension">
                    <h4>Salud (15%)</h4>
                    <div class="progress-bar"><div id="health-progress" class="progress"></div></div>
                    <span id="health-score" class="dimension-score">-</span>
                    <div id="health-metrics" class="metrics-used">-</div>
                </div>
                <div class="dimension">
                    <h4>Crecimiento (10%)</h4>
                    <div class="progress-bar"><div id="growth-progress" class="progress"></div></div>
                    <span id="growth-score" class="dimension-score">-</span>
                    <div id="growth-metrics" class="metrics-used">-</div>
                </div>
            </div>
        </div>

        <div class="metrics-found">
            <h3>Métricas encontradas</h3>
            <div id="metrics-grid" class="metrics-grid"></div>
            <div class="data-quality">
                Completitud de datos: <span id="completeness">0</span>%
                <span id="data-timestamp"></span>
            </div>
        </div>

        <div id="etf-profile" class="etf-profile hidden">
            <h3>Perfil del ETF</h3>
            <p id="etf-description" class="etf-description"></p>
            <div class="etf-meta">
                <span id="etf-category" class="etf-meta-badge"></span>
                <span id="etf-provider" class="etf-meta-badge"></span>
                <span id="etf-data-source" class="etf-meta-badge"></span>
            </div>
        </div>

        <div id="warnings-panel" class="warnings hidden">
            <h3>Advertencias</h3>
            <ul id="warnings-list"></ul>
        </div>
    </section>

    <div id="error-message" class="error-message hidden"></div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='app.js') }}"></script>
{% endblock %}
