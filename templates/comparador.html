{% extends "base.html" %}
{% from "_icons.html" import icon %}

{% block title %}Comparador de Acciones - RVC Analyzer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='comparador.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <section class="page-hero">
        <h1 class="page-hero__title">Comparador de Acciones</h1>
        <p class="page-hero__subtitle">Contrasta hasta cinco empresas y evalúa calidad, precio y potencial en un solo panel.</p>
        <p class="page-hero__disclaimer"><strong>Aviso de datos y responsabilidad:</strong> El comparador RVC utiliza datos agregados de múltiples fuentes públicas y APIs reconocidas. A pesar de los controles, pueden existir errores, omisiones o desfases temporales. Los resultados son cálculos comparativos con fines educativos y no garantizan exactitud ni desempeño futuro. No constituye asesoría financiera; valida la información antes de tomar decisiones o usa proveedores de datos pagos si lo requieres.</p>
    </section>

    <section class="selector-section">
        <h2>Selecciona los tickers a comparar</h2>
        <p class="helper-text">Ingresa entre 2 y 5 tickers (ejemplo: NVDA, AMD, TSM, INTC).</p>

        <div class="ticker-inputs">
            <div class="ticker-input-row">
                <label for="ticker-1">Ticker 1:</label>
                <input type="text" id="ticker-1" class="ticker-input" placeholder="NVDA" maxlength="10">
            </div>
            <div class="ticker-input-row">
                <label for="ticker-2">Ticker 2:</label>
                <input type="text" id="ticker-2" class="ticker-input" placeholder="AMD" maxlength="10">
            </div>
            <div class="ticker-input-row">
                <label for="ticker-3">Ticker 3:</label>
                <input type="text" id="ticker-3" class="ticker-input" placeholder="TSM" maxlength="10">
            </div>
            <div class="ticker-input-row">
                <label for="ticker-4">Ticker 4:</label>
                <input type="text" id="ticker-4" class="ticker-input" placeholder="INTC (opcional)" maxlength="10">
            </div>
            <div class="ticker-input-row">
                <label for="ticker-5">Ticker 5:</label>
                <input type="text" id="ticker-5" class="ticker-input" placeholder="QCOM (opcional)" maxlength="10">
            </div>
        </div>

        <div class="action-buttons">
            <button id="compare-btn" type="button" class="btn btn--primary">
                {{ icon('scale', size=18, class_name='me-1') }} Comparar
            </button>
            <button id="clear-btn" type="button" class="btn btn--secondary">
                {{ icon('trash', size=18, class_name='me-1') }} Limpiar
            </button>
        </div>

        <div id="loading" class="loading hidden">
            <span class="spinner"></span>
            Analizando empresas... puede tomar algunos segundos.
        </div>
    </section>

    <div id="results-container" class="results-container hidden">
        <section class="ranking-section">
            <h2>Ranking de inversión</h2>
            <div id="ranking-cards" class="ranking-cards"></div>
        </section>

        <section class="visualization-section">
            <h2>Visualización comparativa</h2>

            <div class="tabs">
                <button class="tab-btn active" data-tab="scatter">Calidad vs Precio</button>
                <button class="tab-btn" data-tab="bars">Scores</button>
                <button class="tab-btn" data-tab="radar">Perfil multidimensional</button>
            </div>

            <div id="scatter-tab" class="tab-content active">
                <div id="scatter-plot" class="chart-container"></div>
                <div class="chart-legend">
                    <h4>Interpretación</h4>
                    <ul>
                        <li><strong>Zona superior derecha:</strong> alta calidad y precio razonable.</li>
                        <li><strong>Zona superior izquierda:</strong> calidad alta pero valoraciones exigentes.</li>
                        <li><strong>Zona inferior:</strong> calidad limitada; generalmente evitar.</li>
                    </ul>
                </div>
            </div>

            <div id="bars-tab" class="tab-content">
                <div id="bars-chart" class="chart-container"></div>
            </div>

            <div id="radar-tab" class="tab-content">
                <div id="radar-chart" class="chart-container"></div>
                <p class="chart-note">
                    Nota: el radar muestra las primeras tres empresas del ranking para conservar legibilidad.
                </p>
            </div>
        </section>

        <section class="table-section">
            <h2>Comparación detallada</h2>
            <div class="table-wrapper">
                <table id="comparison-table" class="comparison-table"></table>
            </div>
        </section>

        <section class="breakdown-section">
            <h2>Detalle por pilares</h2>
            <p class="helper-text">Basado en el mismo motor del analizador individual.</p>
            <div id="breakdown-grid" class="breakdown-grid"></div>
        </section>

        <section class="conclusion-section">
            <h2>Conclusiones</h2>
            <div class="conclusion-grid">
                <div id="best-option" class="conclusion-card best"></div>
                <div id="worst-option" class="conclusion-card worst"></div>
            </div>
        </section>
    </div>

    <div id="error-message" class="error-message hidden"></div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script src="{{ url_for('static', filename='comparador.js') }}"></script>
{% endblock %}
