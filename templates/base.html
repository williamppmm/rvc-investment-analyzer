<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RVC Analyzer{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='splash.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='usage_limit.css') }}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="site-shell">
        <header class="site-header">
            <div class="site-header__inner container">
                <a href="/" class="site-brand">
                    <span class="site-brand__logo">
                        <img src="{{ url_for('static', filename='img/logo.svg') }}" alt="RVC Analyzer">
                    </span>
                    <span class="site-brand__text">
                        <span class="site-brand__title">RVC Analyzer</span>
                        <span class="site-brand__subtitle">Radar de Valoracion y Calidad</span>
                    </span>
                </a>
                <nav class="site-nav" aria-label="Principal">
                    <a href="{{ url_for('index') }}" class="site-nav__link {% if active_page == 'home' %}is-active{% endif %}">Inicio</a>
                    <a href="{{ url_for('comparador') }}" class="site-nav__link {% if active_page == 'compare' %}is-active{% endif %}">Comparador</a>
                    <a href="{{ url_for('calculadora') }}" class="site-nav__link {% if active_page == 'calculator' %}is-active{% endif %}">Calculadora</a>
                    <a href="{{ url_for('top_opportunities_page') }}" class="site-nav__link {% if active_page == 'opportunities' %}is-active{% endif %}">Ranking</a>
                    <a href="{{ url_for('about') }}" class="site-nav__link {% if active_page == 'about' %}is-active{% endif %}">Acerca de</a>
                    {% if active_page != 'opportunities' and active_page != 'calculator' and active_page != 'about' %}
                    <div class="currency-selector">
                        <label for="currency-select">Moneda</label>
                        <select id="currency-select">
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                        </select>
                    </div>
                    {% endif %}
                </nav>
            </div>
        </header>

        <main class="site-main">
            {% block content %}{% endblock %}
        </main>

        <footer class="site-footer">
            <div class="site-footer__inner container">
                <p class="site-footer__title">RVC Analyzer &mdash; an√°lisis fundamental para inversionistas de largo plazo.</p>
                <p class="site-footer__disclaimer">La informaci√≥n tiene fines educativos y no constituye recomendaci√≥n de inversi√≥n.</p>
                <p class="site-footer__help">
                    <a href="#" id="footer-glossary-link" class="footer-link">¬øDudas sobre los t√©rminos? Consulta el glosario</a>
                </p>
                <!-- Contador de visitas -->
                <div class="visit-counter">
                    <span id="visit-count">
                        <svg class="icon-sm" style="vertical-align: middle;">
                            <use href="#icon-users"></use>
                        </svg>
                        <span class="counter-number">...</span> visitas
                        <span class="separator">|</span>
                        <span style="color: #f59e0b;">üî•</span>
                        <span class="today-number">...</span> hoy
                    </span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Bot√≥n flotante de ayuda -->
    <button id="help-button" class="help-button" aria-label="Abrir glosario de t√©rminos financieros">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        <span class="help-button__text">Ayuda</span>
    </button>

    <!-- Modal de Glosario -->
    <div id="glossary-modal" class="modal hidden">
        <div class="modal__overlay"></div>
        <div class="modal__container">
            <div class="modal__header">
                <h2 class="modal__title">Glosario de T√©rminos Financieros</h2>
                <button id="close-glossary" class="modal__close" aria-label="Cerrar glosario">&times;</button>
            </div>
            <div class="modal__search">
                <input type="text" id="glossary-search" placeholder="Buscar t√©rmino..." class="modal__search-input">
            </div>
            <div class="modal__body" id="glossary-content">
                <!-- Contenido cargado din√°micamente -->
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='currency.js') }}"></script>
    {% if active_page != 'opportunities' and active_page != 'calculator' %}
    <script>
        (async function(){
            const sel = document.getElementById('currency-select');
            if(sel && window.CurrencyManager){
                sel.value = window.CurrencyManager.getCurrency();
                if(sel.value === 'EUR'){
                    await window.CurrencyManager.ensureRate('EUR');
                }
                sel.addEventListener('change', async () => {
                    window.CurrencyManager.setCurrency(sel.value);
                    if(sel.value === 'EUR'){
                        await window.CurrencyManager.ensureRate('EUR');
                    }
                    // Recargar para que cada p√°gina aplique el formato
                    location.reload();
                });
            }
        })();
    </script>
    {% endif %}
    <script src="{{ url_for('static', filename='splash.js') }}"></script>
    <script src="{{ url_for('static', filename='glossary.js') }}"></script>
    <script src="{{ url_for('static', filename='usage_limit.js') }}"></script>
    
    <!-- Contador de visitas -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/visit-count')
            .then(res => res.json())
            .then(data => {
                const counterEl = document.querySelector('.counter-number');
                const todayEl = document.querySelector('.today-number');
                if (counterEl && data.visits !== undefined) {
                    counterEl.textContent = data.visits.toLocaleString('es-ES');
                }
                if (todayEl && data.today !== undefined) {
                    todayEl.textContent = data.today.toLocaleString('es-ES');
                }
            })
            .catch(err => {
                console.log('No se pudo cargar el contador de visitas');
            });
    });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
